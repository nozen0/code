<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="23714291-Nguyenhuuthinh-Tuan09" content="Javascript_jQuery_Regular Expression">
    <title>Bai2</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style.css">
  </head>
  <body>
    <div class="container-fluid">
        <div class="container">
            <header>
                <img style="width: 100%;" src="../images/banner-5.png" alt="">
            </header>
            <section>
                <div id="nav">
                    <ul class="nav">
                        <li class="nav-item">
                            <button class="btn btn-outline-primary">Đăng nhập</button>
                        </li>
                        <li class="nav-item">
                            <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#myModal">Mở tour mới</button>
                        </li>
                    </ul>
                </div>

                <div id="table">
                    <h1 style="text-align: center;">DANH SÁCH TOUR - DU LỊCH VIỆT</h1>
                    <table class="table">
                        <thead>
                            <tr>
                                <td>STT</td>
                                <td>Mã tour</td>
                                <td>Hành trình</td>
                                <td>Ngày khởi hành</td>
                                <td>Thời gian</td>
                                <td>Giá tour</td>
                                <td>Ảnh đại diện</td>
                            </tr>
                        </thead>
                        <tbody id="themTable">
                            
                        </tbody>
                    </table>

                    <div class="modal fade" id="myModal">
                        <div class="modal-dialog" style="max-width: 800px;">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h2 class="modal-title" style="text-align: center;">Thông Tin Tour</h2>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-3">
                                            <p><b>Mã tour</b></p>
                                        </div>
                                        <div class="col-9">
                                            <input type="text" class="form-control" id="maTourTxt">
                                            <span class="err" id="errMaTour">(*)</span>
                                            <br>
                                        </div>

                                        <div class="col-3">
                                            <p><b>Hành trình</b></p>
                                        </div>
                                        <div class="col-9">
                                            <input type="text" class="form-control" id="hanhTrinhTxt">
                                            <span class="err" id="errHanhTrinh">(*)</span>
                                            <br>
                                        </div>

                                        <div class="col-3">
                                            <p><b>Ngày khởi hành</b></p>
                                        </div>
                                        <div class="col-9">
                                            <input type="date" class="form-control" id="ngayKhoiHanhTxt">
                                            <span class="err" id="errNgayKhoiHanh">(*)</span>
                                            <br>
                                        </div>
                                        
                                        <div class="col-3">
                                            <p><b>Thời gian</b></p>
                                        </div>
                                        <div class="col-9">
                                            <input type="text" class="form-control" id="thoiGianTxt"> 
                                            <span class="err">(*)</span>
                                            <br>
                                        </div>

                                        <div class="col-3">
                                            <p><b>Giá tour</b></p>
                                        </div>
                                        <div class="col-9">
                                            <input type="text" class="form-control" id="giaTourTxt">
                                            <span class="err" id="errGiaTour">(*)</span>
                                        </div>

                                        <div class="col-3">
                                            <p><b>Ảnh đại diện</b></p>
                                        </div>
                                        <div class="col-9">
                                            <input type="file" class="form-control" id="anhDaiDienTxt">
                                            <span class="err">(*)</span>
                                            <span class="errAnhDaiDien"></span>
                                        </div>
                                        

                                        <div class="col-12">
                                            <button class="btn btn-success btn-block w-100" id="btnLuu">Lưu</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        let i = 1;
        function ktmaTour()
        {
            let maTour = $("#maTourTxt").val();
            let regex = /^[A-Z]{3}-[A-Z]{3}-\d{2}-\d{4}$/;

            if (maTour == "")
            {
                $("#errMaTour").html("Mã tour không được rỗng");
                return false;
            } else if (!regex.test(maTour))
            {
                $("#errMaTour").html("Mã Tour theo mẫu: XXX-XXX-mm-yyyy với X là các ký tự hoa chỉ thông tin điểm khởi hành và điểm đến, mm: tháng khởi hành, yyyy: năm khởi hành.");
                return false;
            } else 
            {
                $("#errMaTour").html("*");
                return true;
            }
        }

        $("#maTourTxt").blur(function(e)
        {
            ktmaTour();
        });

        function ktHanhTrinh()
        {
            let hanhTrinh = $("#hanhTrinhTxt").val();

            if (hanhTrinh == "")
            {
                $("#errHanhTrinh").html("Hành trình không được rỗng");
                return false;
            } else 
            {
                $("#errHanhTrinh").html("*");
                return true;
            }
        }

        $("#hanhTrinhTxt").blur(function(e)
        {
            ktHanhTrinh();
        });
        
        function ktNgayKhoiHanh()
        {
            let giaTriNgayKhoiHanh = $("#ngayKhoiHanhTxt").val();
            let ngayKhoiHanh = new Date(giaTriNgayKhoiHanh);
            let ngayHienTai = new Date();

            ngayHienTai.setDate(ngayHienTai.getDate() + 30);

            if (!giaTriNgayKhoiHanh)
            {
                $("#errNgayKhoiHanh").html("Ngày khởi hành không được rỗng")
                return false;
            }

            if (ngayKhoiHanh     <= ngayHienTai)
            {
                $("#errNgayKhoiHanh").html("Ngày khởi hành phải sau ngày hiện tại 30 ngày.");
                return false;
            } else
            {
                $("#errNgayKhoiHanh").html("*");
                return true;
            }
        }
        
        $("#ngayKhoiHanhTxt").change(function(e)
        {
            ktNgayKhoiHanh();
        });

        function ktGiaTour()
        {
            let giaTour = $("#giaTourTxt").val();

            if (giaTour <= 0)
            {
                $("#errGiaTour").html("Giá tour phải lớn hơn 0");
                return false;
            } else
            {
                $("#errGiaTour").html("*");
                return true;
            }
        }

        $("#giaTourTxt").blur(function(e)
        {
            ktGiaTour();
        });

        function ktAnhDaiDien() {
        let fileName = $('input[type="file"]').val();
        let fileExtension = fileName.split('.').pop().toLowerCase();
        let allowedExtensions = ['jpg', 'jpeg', 'png', 'gif'];

        if ($.inArray(fileExtension, allowedExtensions) === -1) {
            $(".errAnhDaiDien").html("Hình đại diện phải có định dạng jpg, jpeg, png, hoặc gif.");
            return false;
        } else {
            $(".errAnhDaiDien").html("*");
            return true;
        }
    }

    $('input[type="file"]').change(function(e) {
        ktAnhDaiDien();
    }); 

    $("#btnLuu").click(function(e)
    {
        e.preventDefault();
        if (ktmaTour() && ktNgayKhoiHanh() && ktHanhTrinh() && ktGiaTour() && ktAnhDaiDien)
        {
            let maTour = $("#maTourTxt").val();
            let hanhTrinh = $("#hanhTrinhTxt").val();
            let ngayKhoiHanh = $("#ngayKhoiHanhTxt").val();
            let thoiGian = $("#thoiGianTxt").val();
            let giaTour = $("#giaTourTxt").val();
            let anhDD = $("#anhDaiDienTxt").val();

            let themRow = "<tr><td>" + (i++) + "</td><td>" + maTour + "</td><td>" + hanhTrinh + "</td><td>" + ngayKhoiHanh + "</td><td>" + thoiGian + "</td><td>" + giaTour + "</td><td>" + anhDD + "</td></tr>";
            $("#themTable").append(themRow);
            $("#myModal").modal("hide");
            $("#maTourTxt").val();
            $("#hanhTrinhTxt").val();
            $("#ngayKhoiHanhTxt").val();
            $("#thoiGianTxt").val();
            $("#giaTourTxt").val();
            $("#anhDaiDienTxt").val();
        } else {
            alert("Thông tin không hợp lệ");
        }
    });
    </script>
  </body>
</html>